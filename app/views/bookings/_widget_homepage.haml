:ruby
	if !@booking
		@booking = Booking.new
		if request.post? && !session[:search].blank?
			@booking.starts = Time.zone.parse(session[:search][:starts]) if !session[:search][:starts].blank?
			@booking.ends = Time.zone.parse(session[:search][:ends]) if !session[:search][:starts].blank?
			@booking.location_id =  session[:search][:loc]
			@booking.cargroup_id =  session[:search][:car]
		end
	end
.vertical-widget
	%form{:id => "SearchForm", :onsubmit => "return SubmitForm(this,'/search/homepage','SearchFormDiv');", :action => "javascript:void(0)", "data-ajax" => "false"}
		#StartDate.box
			.cal
			.txt
				- if @booking.starts.blank?
					%input#StartDateVal.datetime.validate-presence{name: 'starts', type: "text", value: "Pickup Date & Time*", readonly: 'true', 'dummy-title' => "Pickup Date & Time*"}
				- else
					%input#StartDateVal.datetime.validate-presence{name: 'starts', type: "text", value: @booking.starts.strftime("%d/%m/%Y %H:%M"), readonly: 'true', 'dummy-title' => "Pickup Date & Time*"}
			.arrw
			.fc
		#StartDateValError.error
			= errortxt(@booking.errors[:starts].uniq.join(', '))
		#EndDate.box
			.cal
			.txt
				- if @booking.ends.blank?
					%input#EndDateVal.datetime.validate-presence{name: 'ends', type: "text", value: "Dropoff Date & Time*", readonly: 'true', 'dummy-title' => "Dropoff Date & Time*"}
				- else
					%input#EndDateVal.datetime.validate-presence{name: 'ends', type: "text", value: @booking.ends.strftime("%d/%m/%Y %H:%M"), readonly: 'true', 'dummy-title' => "Dropoff Date & Time*"}
			.arrw
			.fc
		#EndDateValError.error
			= errortxt(@booking.errors[:ends].uniq.join(', '))
		.dropdown
			#Locations.dropdown-toggle.box{'data-toggle' => "dropdown"}
				.loc
				#LocationHtml.txt
					- if @booking.location_id.blank?
						Choose your location
					- else
						= @booking.location.shortname
				.arrw
				.fc
			%ul#LocationsMenu.dropdown-menu{:role => "menu", 'aria-labelledby' => 'Locations'}
				%li{:id => ("Location"), :role => "presentation"}
					%a{:href => "javascript:void(0)", :onclick => "changeLocation('','All Locations');"}
						All Locations
				- Location.live.each do |l|
					- if l.id == @booking.location_id
						%li.active{:id => ("Location" + l.id.to_s), :role => "presentation"}
							%a{:href => "javascript:void(0)", :onclick => "changeLocation(#{l.id},'#{l.shortname}');"}
								= l.shortname
					- else
						%li{:id => ("Location" + l.id.to_s), :role => "presentation"}
							%a{:href => "javascript:void(0)", :onclick => "changeLocation(#{l.id},'#{l.shortname}');"}
								= l.shortname
		.dropdown
			#Cars.dropdown-toggle.box{'data-toggle' => "dropdown"}
				.car
				#CarHtml.txt 
					- if @booking.cargroup_id.blank?
						Select a car
					- else
						= @booking.cargroup.shortname
				.arrw
				.fc
			%ul#CarsMenu.dropdown-menu{:role => "menu", 'aria-labelledby' => 'Cars'}
				%li{:id => ("Car"), :role => "presentation"}
					%a{:href => "javascript:void(0)", :onclick => "changeCar('','All Cars');"}
						All Cars
				- Cargroup.list.each do |c|
					- if c.id == @booking.cargroup_id
						%li.active{:id => ("Car" + c.id.to_s), :role => "presentation"}
							%a{:href => "javascript:void(0)", :onclick => "changeCar(#{c.id},'#{c.name}');"}
								= c.shortname
					- else
						%li{:id => ("Car" + c.id.to_s), :role => "presentation"}
							%a{:href => "javascript:void(0)", :onclick => "changeCar(#{c.id},'#{c.name}');"}
								= c.shortname
		.hide
			%input#LocationVal{name: 'loc', type: "text", value: @booking.location_id, readonly: 'true'}
			%input#CarVal{name: 'car', type: "text", value: @booking.cargroup_id, readonly: 'true'}
		#SearchSubmit
			= submit_tag "Search Car", :class => 'button size-12 m-auto'
		#SearchWait.p-t15.p-b5{:style => 'display:none;'}
			.wait
- if request.post?
	- if @booking && @booking.valid?
		:javascript
			window.location = "http://#{HOSTNAME}/search";
	- else
		:javascript
			initializeDatePicker();
