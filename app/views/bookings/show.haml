:ruby
	if !flash[:error].blank? && flash[:error].include?('transaction') && flash[:error].include?('failed')
		survey = true
	else
		survey = false
	end
	offer = @booking.offer
- render_flash
%h1.t-c
	= "Booking # " + @booking.confirmation_key.upcase
%br/
- unless @booking.corporate_id.nil?										
	.alert.alert-warning
		.black
			%b Corporate Booking : 
			= @booking.corporate.name
.row
	.col-md-8
		.row.size-20
			.col-md-3
				.p-5
					%b Status
			.col-md-9
				.p-5
					= @booking.status_help
		.row
			.col-md-3
				.p-5 
					%b Car Type
			.col-md-9
				.p-5
					- cargroup = @booking.cargroup
					= cargroup.display_name
					- if !cargroup.disclaimer.blank?
						.red.size-10
							= cargroup.disclaimer.html_safe
		.row
			.col-md-3
				.p-5
					%b Car Rented
			.col-md-9
				.p-5
					- if @booking.paid?
						- if !@booking.car_id.blank?
							- car = @booking.car
							%b #{car.name}
							= "(" + car.license + ")" if !car.license.blank?
						- elsif @booking.status < 6
							.red
								Your car will be allocated by 
								%b
									= (@booking.starts - CommonHelper::ALLOTMENT.minutes).strftime("%d %b, %Y %I:%M %p")
						- else
							\-
		.row
			.col-md-3 
				.p-5
					%b Rented From
			.col-md-9
				.p-5
					- location = @booking.location
					= location.shortname
					- if !location.disclaimer.blank?
						.red.size-10
							= location.disclaimer.html_safe
		.row
			.col-md-3
				.p-5
					%b Pickup Time
			.col-md-9
				.p-5
					= @booking.starts.strftime("%d %b, %Y %I:%M %p")
		.row
			.col-md-3
				.p-5
					%b Dropoff Time
			.col-md-9
				.p-5
					= @booking.ends.strftime("%d %b, %Y %I:%M %p")
		- if offer
			.row
				.col-md-3
					.p-5
						%b Promo Code
				.col-md-9
					.p-5
						%b
							= @booking.promo
						%br/
						= offer.summary.html_safe
		- if @booking.paid?
			.m-t20
				- case @booking.status?
				- when 'live'
					.btn.btn-success{onclick: "showModal('Extend Your Booking', '/bookings/#{@booking.encoded_id}/reschedule');"}
						Extend
					.btn.btn-warning{onclick: "showModal('Shorten Your Booking', '/bookings/#{@booking.encoded_id}/reschedule');"}
						Shorten
				- when 'near'
					.btn.btn-warning{onclick: "showModal('Change Your Booking', '/bookings/#{@booking.encoded_id}/reschedule');"}
						Change
					.btn.btn-danger{onclick: "showModal('Cancel Your Booking', '/bookings/#{@booking.encoded_id}/cancel');"}
						Cancel
				- when 'future'
					.btn.btn-success{onclick: "showModal('Change Your Booking', '/bookings/#{@booking.encoded_id}/reschedule');"}
						Change
					.btn.btn-danger{onclick: "showModal('Cancel Your Booking', '/bookings/#{@booking.encoded_id}/cancel');"}
						Cancel
				- else
					- if @booking.total_payments > 0
						%a.btn.btn-default{href: "/bookings/#{@booking.encoded_id}/invoice", target: '_blank', role: "button"} Invoice
					- if @booking.status_complete?
						%a.btn.btn-default{href: "/bookings/#{@booking.encoded_id}/feedback", target: '_blank', role: "button"} Feedback
		= render :partial => '/bookings/socialshare'
	.col-md-4
		= render :partial => '/bookings/summary', :locals => {:payments => true}
		- if @total > 0
			%a.btn.btn-default.btn-lg{href: "/bookings/#{@booking.encoded_id}/dopayment", role: "button"} Proceed to Payment
- if survey
	:javascript
		var _kiq = _kiq || [];
		(function(){
			setTimeout(function(){
				var d = document, f = d.getElementsByTagName('script')[0], s = d.createElement('script'); s.type = 'text/javascript';
				s.async = true; s.src = '//s3.amazonaws.com/ki.js/53816/bHJ.js'; f.parentNode.insertBefore(s, f);
			}, 1);
		})();
		_kiq.push(['identify', "#{@booking.encoded_id}"]);
